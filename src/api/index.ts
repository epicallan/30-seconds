import fs from "fs";
import * as csv from "fast-csv";
import * as R from "ramda";
import prettier from "prettier";

const result: any[] = [];
const stream = fs.createReadStream("./src/api/skiza.csv");

csv
  .parseStream(stream)
  .on("data", (data: any) => {
    result.push(data);
  })
  .on("error", console.error)
  .on("end", () => {
    const flat = flatten(result);
    const random = R.take(1100, randomize(flat));
    console.log("length", random.length);

    const json = JSON.stringify(R.splitEvery(5, random));
    const content = prettier.format(
      `// this file is autogenerated \n
       // eslint-disable-next-line import/no-anonymous-default-export \n
        export default ${json}`,
      { singleQuote: true }
    );
    fs.writeFile("./src/components/FrontPage/data.ts", content, err => {
      if (err) {
        console.error(err);
        return;
      }
      console.log("File has been created");
    });
  });

const flatten = (arr: string[][]): string[] =>
  R.uniq(R.flatten<string[][]>(arr).filter((word: string) => word && word.length));

const randomize = (arr: any[]) => {
  arr.forEach((_name: any, _index: any) => {
    const randomIndex = Math.floor(Math.random() * arr.length);
    const itemAtIndex = arr[randomIndex];
    arr[randomIndex] = arr[arr.length - 1];
    arr[arr.length - 1] = itemAtIndex;
  });
  return arr;
};
